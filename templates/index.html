<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
    <title>Cap Detector</title>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Cap Detector</h1>
        <p class="subtitle">Powered by Gemini AI</p>
      </header>

      <main>
        <section class="description">
          <p>
            Copy and paste a message if you aren't sure whether it's cap or not.
            For more accurate results, add context.
          </p>
        </section>

        <form id="checkForm" class="form-container">
          <div class="form-group">
            <label for="message">Add your message:</label>
            <textarea
              name="message"
              id="message"
              required
              placeholder="Enter the statement you want to check..."
              rows="4"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="context">Add context: (optional)</label>
            <textarea
              name="context"
              id="context"
              placeholder="Provide additional context to help with verification..."
              rows="3"
            ></textarea>
          </div>

          <button type="submit" id="submitBtn">Check Statement</button>
          <div id="loading" style="display: none">Checking...</div>
        </form>

        <div id="response" class="response-container"></div>
      </main>

      <footer>
        <p>made with ❤️ by jerry.</p>
      </footer>
    </div>

    <script>
      document
        .getElementById("checkForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const message = document.getElementById("message").value;
          const context = document.getElementById("context").value;
          const submitBtn = document.getElementById("submitBtn");
          const loading = document.getElementById("loading");
          const responseDiv = document.getElementById("response");

          // loading
          submitBtn.disabled = true;
          loading.style.display = "block";
          responseDiv.innerHTML = "";

          try {
            const response = await fetch("/check", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                statement: message,
                context: context,
              }),
            });

            const data = await response.json();

            if (data.error) {
              responseDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
            } else {
              responseDiv.innerHTML = `
                        <div class="result">
                            <h3>Verification Result:</h3>
                            <p>${data.result}</p>
                        </div>
                    `;
            }
          } catch (error) {
            responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
          } finally {
            submitBtn.disabled = false;
            loading.style.display = "none";
          }
        });
    </script>
  </body>
</html>
